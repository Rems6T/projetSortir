{% extends 'base.html.twig' %}

{% block title %}Hello MainController!{% endblock %}

{% block body %}
    <div class="container-fluid pt-3">
        <div class="row justify-content-center">
            <div class="col">
                <h2>Bienvenue  !</h2>

                <section id="recherche-form">
                    <div class="row">
                    <div class="col">

                        {% if app.user %}
                        <form action="{{ path('app_search', {'id': app.user.id}) }}" method="post">
                            {% else %}
                            <form action="{{ path('app_search', {'id': 0}) }}" method="post">
                                {% endif %}

                                    <div class="col-md-3">
                                        <label>Campus : </label><select class="btn btn-warning" name="campusS">
                                                <option value=""></option>
                                                {% for campus in campusS %}
                                                    <option id="ville"  name="campus"
                                                            value="{{ campus.id }}">
                                                        {{ campus.nom | upper }}
                                                    </option>
                                                {% endfor %}
                                        </select>
                                    </div>

                            <label>Le nom de la sortie contient : </label>
                            <input type="search" name="search"> <br>

                            <label>Entre </label><input type="date" name="dateMin"><label> et
                            </label><input type="date" name="dateMax"> <br>


                        <div class="col">
                            <label><input type="checkbox" name="est_organisateur">Sorties dont je suis l'organisateur</label><br>
                            <label> <input type="checkbox" name="est_inscrit"> Sorties auquelles je suis inscrit </label><br>
                            <label><input type="checkbox" name="pas_inscrit">Sorties auquelles je ne suis pas inscrit </label><br>
                            <label> <input type="checkbox" name="sortie_terminé"> Sorties passées </label><br>
                            <div class="btn-container"><button>Rechercher</button>
                            </div>
                            </form></form>

                    </div></div>
                </section>

                {% if sorties | length == 0 %}
                <h3 class="text-center mt-5">
                    Aucun résultat trouvé !</h3>
                {% else %}

                <section id="tableau_sorties">
                    <table class="table">
                        <tbody>
                        <tr>
                            <th>Nom de la sortie</th>
                            <th>Date de la sortie</th>
                            <th>Clotûre</th>
                            <th>Nb d'inscrits</th>
                            <th>Etat</th>
                            <th>Inscrit</th>
                            <th>Organisateur</th>
                            <th>Actions</th>
                        </tr>

                        {% for sortie in sorties %}
                        <tr>
                            <td> {{ sortie.nom }}</td>
                            <td>{{ sortie.dateHeureDebut  |date('Y-m-d H:i:s')}}</td>
                            <td>{{ sortie.dateLimiteInscription |date('Y-m-d H:i:s')}}</td>
                            <td> {{ sortie.participantsInscrits|length }} / {{ sortie.nbInscriptionsMax }}</td>
                            <td> {{ sortie.etat.libelle }}</td>
                            <td>  {% if sortie.participantsInscrits == true%}
                                    <i class="fas fa-check-circle"></i>
                                    {% endif %}</td>
                            <td>
                            <a href="{{ path('app_profile_show', {'id': sortie.organisateur.id} ) }}">{{ sortie.organisateur.pseudo }}</a>

                            </td>
                            <td><a href="{{ path('app_sortie',{id: sortie.id}) }}"  title="Détail sortie">Afficher</a>

                                {% if (app.user in sortie.participantsInscrits) %}
                                    <a href="{{ path('app_sortie_desinscription', {'idParticipant': app.user.id,'idSortie': sortie.id}) }}">Désinscription</a>
                                {% endif %}

                                {% if sortie.nbInscriptionsMax > sortie.participantsInscrits|length %}
                                    {% if (app.user not in sortie.participantsInscrits )%}
                                        <a href="{{ path('app_sortie_inscription', {'idParticipant': app.user.id,'idSortie': sortie.id}) }}">Inscription</a>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                            {% endfor %}  {% endif %}
                        </tbody>
                    </table>
            </section>
            </div>
        </div>
        <a class="btn btn-warning " href="{{ path('app_sortie_creer') }}" role="button">Nouvelle sortie</a>

    </div>
{% endblock %}
